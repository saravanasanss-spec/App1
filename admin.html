<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - SRI THIRUPATHI XEROX AND DIGITAL PRINTERS</title>
    <link rel="stylesheet" href="css/admin.css">
</head>
<body>
    <!-- Admin Panel -->
    <div id="adminPanel">
        <header>
            <div class="container">
                <h1>Admin Panel - SRI THIRUPATHI XEROX AND DIGITAL PRINTERS</h1>
                <nav>
                    <a href="index.html">Home</a>
                    <span id="adminUserInfo" style="color: #667eea; margin-left: 15px;"></span>
                    <button class="btn btn-secondary" id="logoutBtn">Logout</button>
                </nav>
            </div>
        </header>

        <main class="container">
            <div class="tabs">
                <button class="tab-btn active" data-tab="menu">Manage Menu</button>
                <button class="tab-btn" data-tab="users">User Master</button>
                <button class="tab-btn" data-tab="inventory">Stock Adjustment</button>
                <button class="tab-btn" data-tab="expenses">Expense Management</button>
                <button class="tab-btn" data-tab="reports">Sales Report</button>
            </div>

            <!-- Manage Menu Tab -->
            <div id="menuTab" class="tab-content active">
                <div class="section-header">
                    <h2>Manage Menu Items</h2>
                    <div class="header-actions">
                        <a href="menu_template.csv" download class="btn btn-secondary" style="text-decoration: none; text-align: center;">
                            ‚¨áÔ∏è Download Template
                        </a>
                        <label for="csvUpload" class="btn btn-success" style="cursor: pointer; margin-right: 10px;">
                            üìÑ Upload CSV
                        </label>
                        <input type="file" id="csvUpload" accept=".csv" style="display: none;">
                        <button class="btn btn-primary" id="addItemBtn">Add New Item</button>
                    </div>
                </div>

                <div class="menu-list" id="menuList">
                    <!-- Menu items will be loaded here -->
                </div>
            </div>

            <!-- Sales Report Tab -->
            <div id="reportsTab" class="tab-content">
                <div class="section-header">
                    <h2>Sales Report</h2>
                    <div class="filter-controls">
                        <div class="filter-group">
                            <label for="menuItemFilter">Filter by Menu Item:</label>
                            <select id="menuItemFilter">
                                <option value="">All Items</option>
                            </select>
                            <button class="btn btn-primary" id="filterMenuItemBtn">Filter by Item</button>
                        </div>
                        <div class="filter-group">
                            <label for="monthFilter">Filter by Month:</label>
                            <input type="month" id="monthFilter">
                            <button class="btn btn-primary" id="filterBtn">Filter by Month</button>
                        </div>
                        <div class="filter-group">
                            <label for="dateFrom">Date From:</label>
                            <input type="date" id="dateFrom">
                            <label for="dateTo">Date To:</label>
                            <input type="date" id="dateTo">
                            <button class="btn btn-primary" id="filterDateRangeBtn">Filter by Date Range</button>
                        </div>
                        <button class="btn btn-secondary" id="clearFilterBtn">Show All</button>
                    </div>
                </div>

                <div class="report-summary" id="reportSummary">
                    <!-- Summary will be loaded here -->
                </div>

                <div class="transactions-list" id="transactionsList">
                    <!-- Transactions will be loaded here -->
                </div>
            </div>

            <!-- User Master Tab -->
            <div id="usersTab" class="tab-content">
                <div class="section-header">
                    <h2>User Management</h2>
                    <button class="btn btn-primary" id="addUserBtn">Add New User</button>
                </div>
                <div class="users-list" id="usersList">
                    <!-- Users will be loaded here -->
                </div>
            </div>

            <!-- Stock Adjustment Tab -->
            <div id="inventoryTab" class="tab-content">
                <div class="section-header">
                    <h2>Stock Adjustment</h2>
                    <button class="btn btn-primary" id="adjustStockBtn">Adjust Stock</button>
                </div>
                <div class="filter-controls adjustment-filters">
                    <div class="filter-group">
                        <label for="adjustmentFilterItem">Filter by Menu Item:</label>
                        <select id="adjustmentFilterItem">
                            <option value="">All Items</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="adjustDateFrom">Date From:</label>
                        <input type="date" id="adjustDateFrom">
                        <label for="adjustDateTo">Date To:</label>
                        <input type="date" id="adjustDateTo">
                    </div>
                    <div class="filter-group">
                        <label class="checkbox-label" style="display: flex; align-items: center; gap: 8px; margin-top: 22px;">
                            <input type="checkbox" id="showBilledAdjustments">
                            Include billed transactions
                        </label>
                    </div>
                    <div class="filter-group" style="align-items: flex-end;">
                        <button class="btn btn-primary" id="filterAdjustmentsBtn">Apply Filters</button>
                        <button class="btn btn-secondary" id="clearAdjustmentsFilterBtn">Clear</button>
                    </div>
                </div>
                <div class="report-summary" id="adjustmentSummary">
                    <!-- Stock adjustment summary will render here -->
                </div>
                <div class="adjustment-form" id="adjustmentForm" style="display: none; background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>Adjust Stock</h3>
                    <form id="stockAdjustmentForm">
                        <label for="adjustMenuItem">Select Item:</label>
                        <select id="adjustMenuItem" required style="width: 100%; padding: 8px; margin-bottom: 15px;">
                            <option value="">Select item...</option>
                        </select>
                        <label for="adjustQuantity">Quantity Change:</label>
                        <input type="number" id="adjustQuantity" step="1" required placeholder="Positive for addition, negative for reduction" style="width: 100%; padding: 8px; margin-bottom: 15px;">
                        <label for="adjustReason">Reason:</label>
                        <input type="text" id="adjustReason" required placeholder="e.g., Received stock, Spoiled stock" style="width: 100%; padding: 8px; margin-bottom: 15px;">
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" class="btn btn-primary">Save Adjustment</button>
                            <button type="button" class="btn btn-secondary" id="cancelAdjustmentBtn">Cancel</button>
                        </div>
                    </form>
                </div>
                <div class="adjustments-list" id="adjustmentsList">
                    <!-- Stock adjustments will be loaded here -->
                </div>
            </div>

            <!-- Expense Management Tab -->
            <div id="expensesTab" class="tab-content">
                <div class="section-header">
                    <h2>Expense Management</h2>
                    <button class="btn btn-primary" id="addExpenseBtn">Add Expense</button>
                </div>
                <div class="expense-form" id="expenseForm" style="display: none; background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>Add Expense</h3>
                    <form id="expenseFormElement">
                        <label for="expensePerson">Person Name:</label>
                        <input type="text" id="expensePerson" required style="width: 100%; padding: 8px; margin-bottom: 15px;">
                        <label for="expensePurpose">Purpose:</label>
                        <input type="text" id="expensePurpose" required style="width: 100%; padding: 8px; margin-bottom: 15px;">
                        <label for="expenseAmount">Amount (‚Çπ):</label>
                        <input type="number" id="expenseAmount" step="0.01" min="0" required style="width: 100%; padding: 8px; margin-bottom: 15px;">
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" class="btn btn-primary">Save Expense</button>
                            <button type="button" class="btn btn-secondary" id="cancelExpenseBtn">Cancel</button>
                        </div>
                    </form>
                </div>
                <div class="expenses-list" id="expensesList">
                    <!-- Expenses will be loaded here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Item Modal -->
    <div id="itemModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modalTitle">Add Menu Item</h2>
            <div class="modal-body">
                <form id="itemForm">
                    <label for="itemName">Item Name:</label>
                    <input type="text" id="itemName" required>

                    <label>Image:</label>
                    <div class="image-upload-section">
                        <div class="image-upload-options">
                            <div class="upload-option">
                                <label for="imageFile" class="upload-label">
                                    <span class="upload-icon">üìÅ</span>
                                    Upload Image
                                </label>
                                <input type="file" id="imageFile" accept="image/*" style="display: none;">
                            </div>
                            <div class="upload-divider">OR</div>
                            <div class="url-option">
                                <label for="itemImage">Enter Image URL:</label>
                                <input type="text" id="itemImage" placeholder="https://example.com/image.jpg">
                            </div>
                        </div>
                        <div class="image-preview" id="imagePreview">
                            <p class="preview-placeholder">No image selected</p>
                        </div>
                    </div>

                    <label for="itemPrice">Default Price (‚Çπ):</label>
                    <input type="number" id="itemPrice" step="0.01" min="0" required>

                    <label for="itemStock">Stock Quantity:</label>
                    <input type="number" id="itemStock" step="1" min="0" value="0" required>

                    <label for="itemMenuId">Menu ID:</label>
                    <input type="text" id="itemMenuId" placeholder="Auto-generated if empty">

                    <div class="modal-actions">
                        <button type="submit" class="btn btn-primary">Save</button>
                        <button type="button" class="btn btn-secondary" id="cancelItemBtn">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="userModalTitle">Add User</h2>
            <div class="modal-body">
                <form id="userForm">
                    <label for="userName">Full Name:</label>
                    <input type="text" id="userName" required>

                    <label for="userUsername">Username:</label>
                    <input type="text" id="userUsername" required>

                    <label for="userPassword">Password:</label>
                    <input type="password" id="userPassword" required>

                    <label for="userRole">Role:</label>
                    <select id="userRole" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                    </select>

                    <div class="modal-actions">
                        <button type="submit" class="btn btn-primary">Save</button>
                        <button type="button" class="btn btn-secondary" id="cancelUserBtn">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <script src="js/firebase-config.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/cloud-storage.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/stock-adjustment.js"></script>
    <script src="js/expense.js"></script>
    <script src="js/admin.js"></script>
    <script>
        // Check authentication for admin panel
        if (typeof Auth !== 'undefined') {
            if (!Auth.checkAuth()) {
                window.location.href = 'login.html';
            }
        }
    </script>
</body>
</html>

